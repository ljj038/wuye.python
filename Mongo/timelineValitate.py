#!/usr/bin/python
# coding=utf-8
import pymongo
import datetime
import time

sDate = '1991-11-11 11:11:11'
iTimestamp = int(time.mktime(time.strptime(sDate, '%Y-%m-%d %H:%M:%S')))
print  iTimestamp
sUTCDate = datetime.datetime.utcfromtimestamp(iTimestamp)
print  sUTCDate
dSchoolCount = {202002585: 0, 202002644: 0, 202002646: 0, 202002619: 0, 202002624: 4768, 202002627: 431, 202002611: 34,
                202002634: 195, 202002637: 1039, 202002605: 2269, 202002643: 1532, 202002588: 2, 202002602: 1250,
                202002595: 2934,
                202002626: 270, 202002630: 1888, 202002582: 1, 202002589: 14, 202002645: 230, 202002608: 1117,
                202002581: 7943, 202002629: 1777, 202002593: 1576, 202002590: 26, 202002604: 1861, 202002622: 595,
                202002606: 9206, 202002651: 51, 202002642: 3, 202002615: 245, 202002640: 44, 202002633: 79,
                202002610: 88, 202002578: 143, 202002597: 469, 202002635: 94, 202002592: 988, 202002623: 396,
                202002621: 13, 202002587: 5556, 202002620: 8654, 202002603: 859, 202002650: 82, 202002600: 1292,
                202002594: 942, 202002591: 2652, 202002596: 6, 202002583: 77, 202002609: 42, 202002599: 1055,
                202002649: 52, 202002607: 295, 202002586: 2939, 202002579: 761, 202002584: 117, 202002636: 5323,
                202002625: 252, 202002638: 49, 202002647: 182, 202002648: 5544, 202002612: 108, 202002616: 1070,
                202002628: 681, 202002613: 1631, 202002632: 121, 202002617: 1, 202002631: 288, 202002639: 482,
                202002614: 160, 202002618: 1457, 202002601: 4, 202002598: 360, 202002580: 149, 202002641: 55}

# 建立连接
objClient = pymongo.MongoClient("127.0.0.1", 27017)
# 设置操作的 database
objDB = objClient['timeline']
for key, value in dict.iteritems(dSchoolCount):
    # 设置操作的集合 collection
    collection = 'zhs_timeline_%d' % (int(key) % 2000)
    iCount = objDB[collection].find({"deleted_time": sUTCDate, "school_id": key}).count()
    if (iCount != value):
        print(key, collection, iCount, value, 'fail')
    else:
        # print(key, collection, iCount, value, 'ok')
        pass
